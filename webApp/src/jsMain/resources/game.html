<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>QR-SHIELD - Beat the Bot</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Challenge QR-SHIELD's offline AI engine. Can you spot phishing URLs faster than the bot?" />
    <meta name="theme-color" content="#0f1115" media="(prefers-color-scheme: dark)" />
    <meta name="theme-color" content="#f6f6f8" media="(prefers-color-scheme: light)" />

    <!-- PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="assets/icon-256.png" />
    <link rel="icon" type="image/svg+xml" href="assets/icon-256.png" />

    <!-- Preload Critical Fonts (prevents FOUT during navigation) -->
    <link rel="preload" href="./fonts/material-symbols.woff2" as="font" type="font/woff2" crossorigin>
    <!-- Local Fonts (Offline-First) -->
    <link href="fonts.css" rel="stylesheet" />

    <!-- Theme System -->
    <link href="theme.css" rel="stylesheet" />
    <!-- Game Styles -->
    <link href="game.css?v=3" rel="stylesheet" />
    <!-- Page Transitions -->
    <link href="transitions.css" rel="stylesheet" />
    <!-- Shared UI Components -->
    <link href="shared-ui.css" rel="stylesheet" />
    <!-- Unified Header Styles -->
    <link href="shared-header.css" rel="stylesheet" />

    <!-- CRITICAL: Blocking theme init to prevent flash -->
    <script>
        (function () {
            try {
                var theme = localStorage.getItem('qrshield_theme');
                if (theme === 'light') {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                    document.documentElement.setAttribute('data-theme', 'light');
                } else if (theme === 'auto' || !theme) {
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                        document.documentElement.classList.remove('dark');
                        document.documentElement.classList.add('light');
                        document.documentElement.setAttribute('data-theme', 'light');
                    }
                }
            } catch (e) { }
        })();
    </script>
</head>

<body class="game-body">
    <div class="game-layout">

        <!-- ============================================
             SIDEBAR NAVIGATION
             ============================================ -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="assets/icon-128.png" alt="QR-SHIELD" style="width: 32px; height: 32px;">
                    <span class="logo-text">QR-SHIELD</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section-label" data-i18n="SectionOverview">Overview</div>
                <a class="nav-link" href="dashboard.html" id="nav-dashboard">
                    <span class="material-symbols-outlined">dashboard</span>
                    <span data-i18n="NavDashboard">Dashboard</span>
                </a>
                <a class="nav-link" href="scanner.html" id="nav-scanner">
                    <span class="material-symbols-outlined">qr_code_scanner</span>
                    <span data-i18n="NavScanMonitor">Live Scanner</span>
                </a>
                <a class="nav-link" href="threat.html" id="nav-history">
                    <span class="material-symbols-outlined">history</span>
                    <span data-i18n="NavScanHistory">Scan History</span>
                </a>

                <div class="nav-section-label" data-i18n="SectionSecurity">Security</div>
                <a class="nav-link" href="trust.html" id="nav-allowlist">
                    <span class="material-symbols-outlined">verified_user</span>
                    <span data-i18n="NavTrustCentre">Allow List</span>
                </a>
                <a class="nav-link" href="onboarding.html" id="nav-settings">
                    <span class="material-symbols-outlined">settings</span>
                    <span data-i18n="NavSettings">Settings</span>
                </a>

                <div class="nav-section-label" data-i18n="SectionTraining">Training</div>
                <a class="nav-link active" href="game.html" id="nav-game">
                    <span class="material-symbols-outlined filled">sports_esports</span>
                    <span data-i18n="NavTraining">Beat the Bot</span>
                </a>

                <div class="nav-section-label" data-i18n="SectionReports">Reports</div>
                <a class="nav-link" href="export.html" id="nav-export">
                    <span class="material-symbols-outlined">download</span>
                    <span data-i18n="NavReports">Export</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">JS</div>
                    <div class="user-info">
                        <span class="user-name" data-i18n="SampleUserName">John Smith</span>
                        <span class="user-role" data-i18n="SampleUserRole">Security Analyst</span>
                    </div>
                    <span class="material-symbols-outlined">expand_more</span>
                </div>
            </div>
        </aside>

        <!-- ============================================
             MAIN CONTENT AREA
             ============================================ -->
        <main class="main-content">

            <!-- Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                </div>

                <div class="header-right">
                    <button class="theme-toggle" aria-label="Toggle theme" title="Toggle light/dark mode">
                        <span class="material-symbols-outlined icon-light">light_mode</span>
                        <span class="material-symbols-outlined icon-dark">dark_mode</span>
                    </button>
                    <div class="header-divider"></div>
                    <button class="header-btn notification-btn" id="notificationBtn" aria-label="Notifications">
                        <span class="material-symbols-outlined">notifications</span>
                        <span class="notification-dot"></span>
                    </button>
                    <button class="header-btn" id="helpBtn" aria-label="Help">
                        <span class="material-symbols-outlined">help</span>
                    </button>
                    <button class="header-btn" id="profileBtn" aria-label="Profile">
                        <span class="material-symbols-outlined">account_circle</span>
                    </button>
                </div>
            </header>

            <!-- Content -->
            <div class="content-scroll">
                <div class="content-container">

                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="page-title">
                            <h1><span data-i18n="BeatTheBot">Beat the Bot</span> <span
                                    class="material-symbols-outlined">smart_toy</span></h1>
                            <p data-i18n="BeatTheBotDesc">Challenge our offline AI engine. Can you spot the phish
                                faster?</p>
                        </div>
                        <div class="session-info">
                            <span class="session-id"><span data-i18n="SessionId">Session ID</span>: #GAME-<span
                                    id="sessionId">8821</span></span>
                            <button class="btn-secondary" id="endSessionBtn" data-i18n="EndSession">End Session</button>
                        </div>
                    </div>

                    <!-- Game Grid -->
                    <div class="game-grid">

                        <!-- Left Column: Challenge Area -->
                        <div class="challenge-column">

                            <!-- Round Progress -->
                            <div class="round-progress">
                                <span class="round-label"><span data-i18n="Round">Round</span> <span
                                        id="currentRound">4</span> / <span id="totalRounds">10</span></span>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill" style="width: 40%">
                                        <div class="progress-shimmer"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Challenge Card -->
                            <div class="challenge-card">
                                <div class="challenge-grid-bg"></div>

                                <div class="challenge-content">
                                    <!-- URL Preview -->
                                    <div class="browser-preview" id="browserPreview">
                                        <div class="browser-header">
                                            <div class="browser-dots">
                                                <span class="dot red"></span>
                                                <span class="dot yellow"></span>
                                                <span class="dot green"></span>
                                            </div>
                                            <span class="browser-label" data-i18n="BrowserPreview">Browser
                                                Preview</span>
                                        </div>

                                        <div class="url-bar">
                                            <span class="material-symbols-outlined">lock</span>
                                            <span class="url-text"
                                                id="challengeUrl">https://au-post-tracking.verify-deliveries.net/login</span>
                                        </div>

                                        <div class="message-preview" id="messagePreview">
                                            <span class="material-symbols-outlined">sms</span>
                                            <div class="message-content">
                                                <span class="message-sender">Incoming Message (+61 491 570 010):</span>
                                                <span class="message-text" id="challengeMessage">"AusPost: Your parcel
                                                    failed delivery due to incorrect address details. Please update
                                                    immediately via the link above to avoid return."</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Decision Buttons -->
                                    <div class="decision-area">
                                        <p class="decision-prompt" data-i18n="MakeDecision">Make your decision</p>
                                        <div class="decision-buttons">
                                            <button class="decision-btn phishing" id="btnPhishing">
                                                <div class="btn-gradient"></div>
                                                <div class="btn-content">
                                                    <span class="material-symbols-outlined">warning</span>
                                                    <span data-i18n="Phishing">Phishing</span>
                                                </div>
                                            </button>
                                            <button class="decision-btn legitimate" id="btnLegitimate">
                                                <div class="btn-gradient"></div>
                                                <div class="btn-content">
                                                    <span class="material-symbols-outlined">check_circle</span>
                                                    <span data-i18n="Legitimate">Legitimate</span>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hint Card -->
                            <div class="hint-card">
                                <span class="material-symbols-outlined">lightbulb</span>
                                <div class="hint-content">
                                    <h4 data-i18n="LiveHint">Live Hint</h4>
                                    <p id="hintText">Look closely at the domain structure. Legitimate organisations
                                        rarely use hyphens in the main domain name or generic TLDs like
                                        <code>.net</code> for core services.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Scoreboard & Analysis -->
                        <div class="sidebar-column">

                            <!-- Scoreboard -->
                            <div class="scoreboard-card">
                                <div class="scoreboard-header">
                                    <h3 data-i18n="LiveScoreboard">Live Scoreboard</h3>
                                    <span class="vs-badge" data-i18n="VsMode">VS MODE</span>
                                </div>

                                <div class="scores">
                                    <!-- Player Score -->
                                    <div class="score-row player">
                                        <div class="score-header">
                                            <span class="score-name" data-i18n="You">You</span>
                                            <span class="score-value" id="playerScore">350 pts</span>
                                        </div>
                                        <div class="score-bar">
                                            <div class="score-fill player" id="playerBar" style="width: 75%"></div>
                                        </div>
                                        <div class="score-stats">
                                            <span><span data-i18n="Streak">Streak</span>: <span
                                                    id="playerStreak">3</span> ðŸ”¥</span>
                                            <span><span data-i18n="Accuracy">Accuracy</span>: <span
                                                    id="playerAccuracy">100%</span></span>
                                        </div>
                                    </div>

                                    <!-- Bot Score -->
                                    <div class="score-row bot">
                                        <div class="score-header">
                                            <span class="score-name">
                                                <span class="material-symbols-outlined">smart_toy</span>
                                                <span data-i18n="QrShieldBot">QR-Shield Bot</span>
                                            </span>
                                            <span class="score-value" id="botScore">400 pts</span>
                                        </div>
                                        <div class="score-bar">
                                            <div class="score-fill bot" id="botBar" style="width: 85%"></div>
                                        </div>
                                        <div class="score-stats">
                                            <span><span data-i18n="Latency">Latency</span>: 2ms</span>
                                            <span><span data-i18n="Confidence">Confidence</span>: 99.8%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Round Analysis -->
                            <div class="analysis-card">
                                <h3><span data-i18n="RoundAnalysis">Round</span> <span id="analysisRound">3</span> <span
                                        data-i18n="Analysis">Analysis</span></h3>

                                <div class="result-badge" id="resultBadge">
                                    <div class="result-icon success">
                                        <span class="material-symbols-outlined">check</span>
                                    </div>
                                    <div class="result-text">
                                        <p class="result-title" id="resultTitle" data-i18n="CorrectDecision">Correct
                                            Decision!</p>
                                        <p class="result-desc" id="resultDesc" data-i18n="IdentifiedSafe">You identified
                                            the safe URL correctly.
                                        </p>
                                    </div>
                                </div>

                                <!-- Brain Visualizer Section -->
                                <div class="brain-visualizer-section" id="brainVisualizerSection">
                                    <h4 data-i18n="AiNeuralAnalysis">AI Neural Analysis</h4>
                                    <p class="brain-description visually-hidden" id="brainDescription" role="status"
                                        aria-live="polite">
                                        AI Neural Net: No threats detected. Brain pattern is calm and blue.
                                    </p>
                                    <canvas id="brainCanvas" width="300" height="200" aria-hidden="true"></canvas>
                                    <div class="signal-badges" id="signalBadges"></div>
                                </div>

                                <div class="bot-reasoning">
                                    <p class="reasoning-title">Why the bot flagged it <span
                                            id="botDecision">Safe</span>:</p>
                                    <ul class="reasoning-list" id="reasoningList">
                                        <li>
                                            <span class="material-symbols-outlined">verified</span>
                                            <span>Certificate Issuer matches domain owner (DigiCert Inc).</span>
                                        </li>
                                        <li>
                                            <span class="material-symbols-outlined">history</span>
                                            <span>Domain age > 5 years (High trust).</span>
                                        </li>
                                        <li>
                                            <span class="material-symbols-outlined">public</span>
                                            <span>Top 1k Alexa Rank whitelisted offline.</span>
                                        </li>
                                    </ul>
                                </div>

                                <div class="educational-note">
                                    <h4 data-i18n="EducationalNote">Educational Note</h4>
                                    <p id="educationalNote">"Always expand short links before scanning. The bot does
                                        this automatically by following redirect headers without rendering the page."
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <!-- Result Modal -->
    <div class="modal-overlay hidden" id="resultModal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon">
                <span class="material-symbols-outlined">check_circle</span>
            </div>
            <h2 id="modalTitle">Correct!</h2>
            <p id="modalMessage">You spotted the phishing URL correctly.</p>
            <div class="modal-stats">
                <div class="stat">
                    <span class="stat-value" id="modalPoints">+50</span>
                    <span class="stat-label" data-i18n="Points">Points</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="modalTime">1.2s</span>
                    <span class="stat-label" data-i18n="Response">Response</span>
                </div>
            </div>
            <button class="btn-primary" id="nextRoundBtn" data-i18n="NextRound">Next Round</button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal-overlay hidden" id="gameOverModal">
        <div class="modal-content game-over">
            <div class="modal-icon trophy">
                <span class="material-symbols-outlined">emoji_events</span>
            </div>
            <h2 id="gameOverTitle">Game Over!</h2>
            <p id="gameOverMessage">Final Results</p>
            <div class="final-scores">
                <div class="final-score player">
                    <span class="label" data-i18n="YourScore">Your Score</span>
                    <span class="value" id="finalPlayerScore">850</span>
                </div>
                <div class="vs">VS</div>
                <div class="final-score bot">
                    <span class="label" data-i18n="BotScore">Bot Score</span>
                    <span class="value" id="finalBotScore">920</span>
                </div>
            </div>
            <div class="game-stats">
                <div class="stat">
                    <span class="stat-value" id="finalAccuracy">85%</span>
                    <span class="stat-label" data-i18n="Accuracy">Accuracy</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="finalBestStreak">5</span>
                    <span class="stat-label" data-i18n="BestStreak">Best Streak</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-primary" id="playAgainBtn" data-i18n="PlayAgain">Play Again</button>
                <a href="dashboard.html" class="btn-secondary" data-i18n="ReturnToDashboard">Return to Dashboard</a>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <span class="material-symbols-outlined toast-icon">check_circle</span>
        <span class="toast-message" id="toastMessage">Success!</span>
    </div>

    <!-- Platform Bridge (Crypto, Clipboard, etc.) -->
    <script src="platform-bridge.js"></script>
    <!-- Kotlin/JS Bundle -->
    <script src="webApp.js"></script>
    <!-- Theme System -->
    <script src="theme.js"></script>
    <!-- Page Transitions -->
    <script src="transitions.js"></script>
    <!-- Shared UI Components -->
    <script src="shared-ui.js"></script>
    <!-- Brain Visualizer -->
    <script src="visualizer.js"></script>
    <!-- Game Logic -->
    <script src="game.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('[PWA] Service worker registered:', reg.scope))
                    .catch(err => console.warn('[PWA] Service worker failed:', err));
            });
        }
    </script>
</body>

</html>